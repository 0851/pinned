/**
 * Moon v1.0.0-beta.2
 * Copyright 2016-2018 Kabir Shah
 * Released under the MIT License
 * https://kbrsh.github.io/moon
 */
!function(e,t){"undefined"==typeof module?e.Moon=t():module.exports=t()}(this,function(){"use strict";var t=/"[^"]*"|'[^']*'|\d+[a-zA-Z$_]\w*|\.[a-zA-Z$_]\w*|[a-zA-Z$_]\w*:|([a-zA-Z$_]\w*)/g,r=["NaN","false","in","null","this","true","typeof","undefined"],f=function(e){var n=!1;return{expression:e=e.replace(t,function(e,t){return void 0===t||-1!==r.indexOf(t)?e:(n=!0,"$"===t[0]?"locals."+t:"instance."+t)}),dynamic:n}},e={silent:!0},v=/^\s+$/,oe=function(e){return e[0]===e[0].toUpperCase()&&e[0]!==e[0].toLowerCase()},d=/[\s/>]/,l=function(e,t,n,r){for(;e<n;){var i=t[e];if("/"===i||">"===i)break;if(v.test(i))e+=1;else{for(var o="",a=void 0,u=!1;e<n;){if("/"===(i=t[e])||">"===i||v.test(i)){a="";break}if("="===i){e+=1;break}o+=i,e+=1}if(void 0===a){var s=void 0;for(a="",'"'===(i=t[e])||"'"===i?(s=i,e+=1):"{"===i?(s="}",u=!0,e+=1):s=d;e<n;){if(i=t[e],"object"==typeof s&&s.test(i)||i===s){e+=1;break}a+=i,e+=1}}var c=!1;if(u){var l=f(a);a=l.expression,c=l.dynamic}r.push({key:o,value:a,expression:u,dynamic:c})}}return e},a=function(e,t,n,r){for(var i={type:"",attributes:[],children:[]};e<n;){var o=t[e];if("/"===o||">"===o){var a=i.attributes,u=r.length-1;"/"===o?e+=1:r.push(i);for(var s=0;s<a.length;){var c=a[s];oe(c.key)?(i={type:c.key,attributes:[{key:"",value:c.value,expression:c.expression,dynamic:c.dynamic}],children:[i]},a.splice(s,1)):s+=1}r[u].children.push(i),e+=1;break}v.test(o)&&(e+=1)||"="===o?e=l(e,t,n,i.attributes):(i.type+=o,e+=1)}return e},u=function(e,t,n,r){for(;e<n;e++){var i=t[e];if(">"===i){e+=1;break}i}var o=r.pop();return o.type,e},s=function(e,t,n){for(;e<n;){var r=t[e],i=t[e+1],o=t[e+2];if("<"===r&&"!"===i&&"-"===o&&"-"===t[e+3])e=s(e+4,t,n);else{if("-"===r&&"-"===i&&">"===o){e+=3;break}e+=1}}return e},c=/(?:(?:&(?:amp|gt|lt|nbsp|quot);)|"|\\|\n)/g,m={"&amp;":"&","&gt;":">","&lt;":"<","&nbsp;":" ","&quot;":'\\"',"\\":"\\\\",'"':'\\"',"\n":"\\n"},p=function(e,t,n,r){for(var i="";e<n;e++){var o=t[e];if("<"===o||"{"===o)break;i+=o}return v.test(i)||r[r.length-1].children.push({type:"Text",attributes:[{key:"",value:i.replace(c,function(e){return m[e]}),expression:!1,dynamic:!1}],children:[]}),e},h=function(e,t,n,r){for(var i="";e<n;e++){var o=t[e];if("}"===o){e+=1;break}i+=o}var a=f(i);return r[r.length-1].children.push({type:"Text",attributes:[{key:"",value:a.expression,expression:!0,dynamic:a.dynamic}],children:[]}),e},n=function(e){for(var t=e.length,n={element:0,referenceElement:1,nextElement:2,type:"Root",attributes:[],children:[]},r=[n],i=0;i<t;){var o=e[i];i="<"===o?"!"===e[i+1]&&"-"===e[i+2]&&"-"===e[i+3]?s(i+4,e,t):"/"===e[i+1]?u(i+2,e,t,r):a(i+1,e,t,r):"{"===o?h(i+1,e,t,r):p(i,e,t,r)}return n},ae=function(e){return"m"+e},ue=function(e,t){return ae(e)+"="+t},se=function(e){return e.expression?e.value:'"'+e.value+'"'},ce=function(e,t){return"m.rc("+ae(e)+","+ae(t)+");"},le=function(e,t,n,r,i,o){return"m.df("+e+","+ae(t)+","+n+","+ae(r)+","+ae(i)+","+ae(o)+");"},fe=function(e,t,n){return null===n?(o=t,"m.ac("+ae(e)+","+ae(o)+");"):(r=n,i=t,"m.ib("+ae(e)+","+ae(r)+","+ae(i)+");");var r,i,o},ve=function(e,t,n,r){switch(e.type){case"If":for(var i=n.nextElement++,o=n.nextElement++,a=n.nextElement++,u=n.nextElement++,s="[",c="[",l="",f=t.children,v=f.indexOf(e);v<f.length;v++){var d=f[v];if("If"!==d.type&&"ElseIf"!==d.type&&"Else"!==d.type)break;s+=l+("Else"===d.type?"true":se(d.attributes[0])),c+=l+"function(locals){"+de({element:n.nextElement,nextElement:n.nextElement+1,type:"Root",attributes:[],children:d.children},o)+"}({})",l=","}return[ue(o,"m.cc();")+fe(o,t.element,r)+ue(u,c+"];"),ue(a,s+"];")+ue(i,(te=i,ne=a,re=u,ie=t.element,"m.di("+ae(te)+","+ae(ne)+","+ae(re)+","+ae(ie)+");")),ae(i)+"[2]();"];case"ElseIf":case"Else":return["","",""];case"For":for(var m=se(e.attributes[0]),p="[",h="",y=n.nextElement++,b=n.nextElement++,x=n.nextElement++,g=n.nextElement++,E="",k="",_=0;_<m.length;_++){var w=m[_];","===w||" "===w&&"i"===m[_+1]&&"n"===m[_+2]&&" "===m[_+3]&&(_+=3)?(p+=k+'"'+E.substring(7)+'"',E="",k=","):E+=w}return p+="]",h+=E,[ue(y,"m.cc();")+fe(y,t.element,r)+ue(b,"function(locals){"+de({element:n.nextElement,nextElement:n.nextElement+1,type:"Root",attributes:[],children:e.children},y)+"};")+ue(x,"[];")+ue(g,"[];"),le(p,g,h,b,x,t.element),le(p,g,"[]",b,x,t.element)];case"Text":var $=e.attributes[0],C=n.nextElement++,q=(Y=C,ee=se($),"m.stc("+ae(Y)+","+ee+");"),A=ue(C,"m.ctn("+'""'+");"),T="";return $.dynamic?T+=q:A+=q,[A+fe(C,t.element,r),T,ce(C,t.element)];default:var z=e.attributes,I=e.children;if(oe(e.type)){e.component=n.nextElement++;for(var U=ue(e.component,"new m.c."+e.type+"();"),Z="",D=!1,N=0;N<z.length;N++){var O=z[N];if("@"===O.key[0])U+=ae(e.component)+'.on("'+O.key.substring(1)+'",function($event){locals.$event=$event;'+se(O)+";});";else{var R=ae(e.component)+"."+O.key+"="+se(O)+";";O.dynamic?(D=!0,Z+=R):U+=R}}return U+=ae(e.component)+".create("+ae(t.element)+");",D?Z+=ae(e.component)+".update();":U+=ae(e.component)+".update();",[U,Z,ae(e.component)+".destroy();"]}e.element=n.nextElement++;for(var j=ue(e.element,'m.ce("'+e.type+'");'),F="",L=0;L<z.length;L++){var B=z[L],M=void 0;if("@"===B.key[0]){var S=void 0,G=void 0;if("@bind"===B.key){var H=se(B);M=ae(e.element)+".value="+H+";",S="input",G=H+"=$event.target.value;instance.update();"}else M="",S=B.key.substring(1),G="locals.$event=$event;"+se(B)+";";j+=(V=e.element,W=S,X="function($event){"+G+"}","m.ael("+ae(V)+',"'+W+'",'+X+");")}else P=e.element,Q=B,M="m.sa("+ae(P)+',"'+Q.key+'",'+se(Q)+");";B.dynamic?F+=M:j+=M}for(var J=0;J<I.length;J++){var K=ve(I[J],e,n,null);j+=K[0],F+=K[1]}return[j+fe(e.element,t.element,r),F,ce(e.element,t.element)]}var P,Q,V,W,X,Y,ee,te,ne,re,ie},de=function(e,t){for(var n=e.children,r="",i="",o="",a=0;a<n.length;a++){var u=ve(n[a],e,e,t);r+=u[0],i+=u[1],o+=u[2]}for(var s="var "+ae(e.element),c=e.element+1;c<e.nextElement;c++)s+=","+ae(c);return s+";return [function(_0){"+ue(e.element,"_0;")+r+"},function(){"+i+"},function(){"+o+"}];"},y=function(e){return de(n(e),null)},i={},b={c:i,ce:function(e){return document.createElement(e)},ctn:function(e){return document.createTextNode(e)},cc:function(){return document.createComment("")},sa:function(e,t,n){e.setAttribute(t,n)},ael:function(e,t,n){e.addEventListener(t,n)},stc:function(e,t){e.textContent=t},ac:function(e,t){t.appendChild(e)},rc:function(e,t){t.removeChild(e)},ib:function(e,t,n){n.insertBefore(e,t)},di:function(e,t,n,r){for(var i=0;i<t.length;i++)if(t[i]){var o=n[i];return e===o?o[1]():(e&&e[2](),o[0](r),o[1](),e=o),e}},df:function(e,t,n,r,i,o){for(var a=i.length,u=n.length,s=u<a?a:u,c=e[1],l=e[0],f=0;f<s;f++)if(a<=f){var v={};v[c]=f,v[l]=n[f];var d=r(t[f]=v);i.push(d),d[0](o),d[1]()}else if(u<=f)i.pop()[2]();else{var m=t[f];m[c]=f,m[l]=n[f],i[f][1]()}}},x=function(e){this._view[0](e),this.emit("create")},g=function(e,t){if(void 0!==e)if("object"==typeof e)for(var n in e)this[n]=e[n];else this[e]=t;if(!1===this._queued){this._queued=!0;var r=this;setTimeout(function(){r._view[1](),r._queued=!1,r.emit("update")},0)}},E=function(){this._view[2](),this.emit("destroy")},k=function(e,t){var n=this._events,r=n[e];void 0===r?n[e]=[t]:r.push(t)},_=function(e,t){if(void 0===e)this._events={};else if(void 0===t)this._events[e]=[];else{var n=this._events[e];n.splice(n.indexOf(t),1)}},w=function(e,t){var n=this._events[e];if(void 0!==n)if("function"==typeof n)n(t);else for(var r=0;r<n.length;r++)n[r](t)},o=function(i,o){return function(){var e;this._name=i,this._queued=!1,"string"==typeof(e=void 0===o?{}:"function"==typeof o?o():o).view?this._view=new Function("m","instance","locals",y(e.view))(b,this,{}):this._view=e.view(b,this,{}),delete e.view;var t={};for(var n in void 0!==e.onCreate&&(t.create=e.onCreate.bind(this),delete e.onCreate),void 0!==e.onUpdate&&(t.update=e.onUpdate.bind(this),delete e.onUpdate),void 0!==e.onDestroy&&(t.destroy=e.onDestroy.bind(this),delete e.onDestroy),this._events=t,e){var r=e[n];this[n]="function"==typeof r?r.bind(this):r}this.create=x,this.update=g,this.destroy=E,this.on=k,this.off=_,this.emit=w}};function $(e){var t=e.root;delete e.root,"string"==typeof t&&(t=document.querySelector(t));var n=new(o("",e));return n.create(t),n.update(),n}return $.extend=function(e,t){i[e]=o(e,t)},$.parse=n,$.generate=de,$.compile=y,$.config=e,$});